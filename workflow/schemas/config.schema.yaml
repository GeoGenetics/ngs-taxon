$schema: "https://json-schema.org/draft/2020-12/schema"

description: Read taxonomic assignment configuration file

type: object
properties:

  samples:
    type: string

  units:
    type: string

  ref:
    type: object
    patternProperties:
      "^.+$":
        type: object
        properties:
          bt2l:
            type: boolean
          n_chunks:
            type: integer
            minimum: 1
          path:
            type: string
        required:
          - n_chunks
          - path
    additionalProperties: false

  align:
    type: object
    properties:
      map:
        type: object
        properties:
          params:
            type: string
            pattern: "^((?!\b--?(threads|mm|t|time|q|U|1|2|interleaved|x|b|S|rd-id|rg)[ =]).)*$"
        required:
          - params
      reassign:
        type: object
        properties:
          activate:
            type: boolean
          params:
            type: string
            pattern: "^((?!\b--?(t|threads|bam|m|sort-memory|N|sort-by-name|r|reference-lengths|p|prefix)[ =]).)*$"
        required:
          - activate
          - params
      filter:
        type: object
        properties:
          activate:
            type: boolean
          params:
            type: string
            pattern: "^((?!\b--?(t|threads|bam|low-memory|m|sort-memory|N|sort-by-name|disable-sort|r|reference-lengths|tmp-dir|bam-filtered|stats|stats-filtered|read-length-freqs|read-hits-count|only-stats|only-stats-filtered|knee-plot|plot|p|prefix)[ =]).)*$"
        required:
          - activate
          - params
      mark_duplicates:
        type: object
        properties:
          activate:
            type: boolean
          tool:
            type: string
            enum: ["markduplicates", "markduplicatesspark", "markduplicateswithmatecigar", "bamsormadup"]
          params:
            type: string
            pattern: "^((?!\b(--)?(input|INPUT|tmp-dir|TMP_DIR|SO|ASO|ASSUME_SORT_ORDER|coordinate|create-output-bam-splitting-index|output|OUTPUT|metrics-file|METRICS_FILE)[ =]).)*$"
        required:
          - activate
          - tool
          - params
      calmd:
        type: object
        properties:
          activate:
            type: boolean
          params:
            type: string
            pattern: "^((?!\b--?(@|threads|b) ).)*$"
        required:
          - activate
          - params
    required:
      - map
      - reassign
      - filter
      - mark_duplicates
      - calmd

  taxonomy:
    type: object
    properties:
      names:
        type: string
      nodes:
        type: string
      acc2taxid:
        type: string
    required:
      - names
      - nodes
      - acc2taxid

  metadmg:
    type: object
    properties:
      damage:
        type: object
        properties:
          params:
            type: string
            pattern: "^((?!\b--?(n|threads|r|run_mode|o|out_prefix)[ =]).)*$"
        required:
          - params
      lca:
        type: object
        properties:
          params:
            type: string
            pattern: "^((?!\b--?(n|threads|bam|nodes|names|acc2tax|temp|out|out_prefix)[ =]).)*$"
        required:
          - params
      dfit:
        type: object
        properties:
          params:
            type: string
            pattern: "^((?!\b--?(n|nthreads|nodes|names|doboot|lib|out|out_prefix)[ =]).)*$"
        required:
          - params
    required:
      - damage
      - lca
      - dfit

  report:
    type: object
    properties:
      multiqc:
        type: string
    required:
      - multiqc

required:
  - samples
  - units
  - ref
  - align
  - taxonomy
  - metadmg
  - report
